<html>
<head>
<title>{&admin_name} 管理面版 v{&admin_var}</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="keywords" content="{&admin_keywords}">
<meta name="description" content="{&admin_description}">
<link rel='stylesheet' type='text/css' href='__PUBLIC__/css/admin.css'>
<script language="JavaScript" charset="utf-8" type="text/javascript" src="__PUBLIC__/js/admin.js"></script>
<script language="JavaScript" charset="utf-8" type="text/javascript" src="__PUBLIC__/js/jquery.js"></script>
</head>
<body>
<tagLib name="html" />
<script language="javascript">
// 设置审核状态
function setisok(id){
 	var isok = 0;
	if($('#isok_'+id).attr('title')=='已审核'){
		isok = 1;
	}
	var html = $.ajax({
		url: "index.php?s=Admin-News-Ajaxdel-id-"+id+"-isok-"+isok,
		async: false
	}).responseText;
	if(html){
		if(isok==1){
			$('#isok_'+id).attr({src:'__PUBLIC__/images/no.gif', title:'未审核'});
		} else{
			$('#isok_'+id).attr({src:'__PUBLIC__/images/yes.gif', title:'已审核'});
		}
	}
}
//设置权重
function sethot(id, hot){
	var html = $.ajax({
		url: 'index.php?s=Admin-News-Ajaxhot-id-'+id+'-hot-'+hot,
		async: false
	}).responseText;
	if(html){
		for(i=0; i<6; i++){
			$('#hot_'+id+'_'+i).removeClass('hot_on');
		}
		$('#hot_'+id+'_'+hot).addClass('hot_on');
	}
}
// 消息框loading
function loading(){
	 var o = $('#body_loading');
     o.css("left",(($(document).width())/2-(parseInt(o.width())/2))+"px");
     o.css("top",(($(document).height()+$(document).scrollTop())/2-(parseInt(o.height())/2))+"px");
	 o.fadeIn("fast");
}
// 消息框消失
function loaded(){
	var o = $('#body_loading');
	o.fadeOut("fast");
}
// 图片预览
function showpic(event,imgsrc){	
	var left = event.clientX+document.body.scrollLeft+20;
	var top = event.clientY+document.body.scrollTop+20;
	$("#preview").css({left:left,top:top,display:""});
	$("#pic_a1").attr("src",imgsrc);
}
// 取消预览
function hiddenpic(){
	$("#preview").css({display:"none"});
}
// 隐藏图片上传框
function hideupload(){
	$('#show_upload').hide();
	$('#show_upload_iframe').hide();
}
// 显示标签框
function showtags(){
	var offset = $("#news_tag").offset();
	var left = offset.left;
	var top = offset.top+21;
	var html = $.ajax({
		url: "index.php?s=Admin-Tag-Show-id-ajax",
		async: false
	}).responseText;
	$("#showtags").html(html);
	$("#showtags").css({left:left,top:top,display:""});
}
// 添加标签
function addtag(tag){
	var val = $('#news_tag').val();
	if(val!=''){
		val = val+','+tag;
	}else{
		val = tag;
	}
	$('#news_tag').val(val);
	tb_close();
}
// 关闭标签框
function tb_close(){
	$("#showtags").css('display','none');
}
//弹出生成网页框
function showhtml(vodid){
	loading();
	var o=$('#show_upload');
	var f=$('#show_upload_iframe');
	var top = 250;	
	$.ajax({
		url: 'index.php?s=Admin-Html-readnewsid-id-'+vodid+'',
		//cache: false,
		success: function(res){
			loaded();
			o.html(res);
			o.css("left",(($(document).width())/2-(parseInt(o.width())/2))+"px");
			if($(document).scrollTop()>250){
				top = ($(document).height()+$(document).scrollTop())/2-(parseInt(o.height())/2);
			}
     		o.css("top",top+"px");
			f.css({'width':o.width(),'height':o.height(),'left':o.css('left'),'top':o.css('top')});
	 		f.show();
			o.show();
			setTimeout("hideupload()",1000);
		}
	});
}
// 弹出图片上传框
function showupload(type){
	loading();
	var o=$('#show_upload');
	var f=$('#show_upload_iframe');
	var top = 200;
	$.ajax({
		url: 'index.php?s=Admin-Upload',
		//cache: false,
		success: function(res){
			loaded();
			o.html(res);
			o.css("left",(($(document).width())/2-(parseInt(o.width())/2))+"px");
			if($(document).scrollTop()>200){
				top = ($(document).height()+$(document).scrollTop())/2-(parseInt(o.height())/2);
			}
     		o.css("top",top+"px");
			f.css({'width':o.width(),'height':o.height(),'left':o.css('left'),'top':o.css('top')});
	 		f.show();
			o.show();
		}
	});
}
</script>
<div class="right">
  <div class="right_top">{&admin_welcome}</div>
  <div class="right_main">
  <!--图片预览框-->
  <div id="preview" style="position:absolute;display:none;width:75;height:75;" class="showpic"> <img name="pic_a1" id="pic_a1" width="75" height="75"></div>
  <!--消息框遮罩层-->
  <iframe id="show_upload_iframe" frameborder=0 scrolling="no" style="display:none; position:absolute;"></iframe><div id="show_upload">nothing...</div>
  <!--页面加载中-->
  <div id="body_loading" onClick="loaded();"><img src="__PUBLIC__/images/body_load.gif"></div>
  <!--标签选择框-->
  <div id="showtags" style="position:absolute;display:none;" class="showtags">标签加载中...<br><a href="javascript:tb_close()">关闭</a></div> 
  <!--缩略图上传-->
  <iframe name="iframeUpload" src="" width="350" height="35" frameborder=0  scrolling="no" style="display:none"></iframe>
<if condition="strtolower(ACTION_NAME) eq show ">
    <form action="index.php?s=Admin-News-Show" method="post">{__NOTOKEN__}
      <table width="98%" border="0" cellpadding="4" cellspacing="1" class="tableoutline">
        <tr class="tb_head">
          <td colspan="5"><h2>数据列表：</h2></td>
        </tr>
        <tr class="firstalt">
          <td colspan="5" style="line-height:30px;"> 筛选内容：
            <select name="news_cid" id="news_cid" ><option value="0">全部分类</option>
              <volist name="listnews" id="pp">
                <option value="{$pp.list_id}" <eq name="pp.list_id" value="$news_cid">selected</eq>>{$pp.list_name}</option>
                <volist name="pp['son']" id="pp">
                <option value="{$pp.list_id}" <eq name="pp.list_id" value="$news_cid">selected</eq>>├ {$pp.list_name}</option>
                </volist>
              </volist>
            </select>
            &nbsp;&nbsp;
            <select name="news_stars" id="news_stars" class="select">
              <option value="0" <eq name="news_stars" value="0">selected</eq>>所有星级</option>
              <option value="1" <eq name="news_stars" value="1">selected</eq>>一星内容</option>
              <option value="2" <eq name="news_stars" value="2">selected</eq>>二星内容</option>
              <option value="3" <eq name="news_stars" value="3">selected</eq>>三星内容</option>
              <option value="4" <eq name="news_stars" value="4">selected</eq>>四星内容</option>
              <option value="5" <eq name="news_stars" value="5">selected</eq>>五星内容</option>
            </select>
            &nbsp;&nbsp;
            <select name="news_del" id="news_del" class="select">
              <option value="2">全部状态</option>
              <option value="0" <eq name="news_del" value="0">selected</eq>>已审核</option>
              <option value="1" <eq name="news_del" value="1">selected</eq>>未审核</option>
            </select>
            &nbsp;&nbsp;
            <select name="news_type" id="news_type" class="select">
              <option value="0">排序方式</option>
              <option value="news_hits" <eq name="news_type" value="news_hits">selected</eq>>人气</option>
              <option value="news_addtime" <eq name="news_type" value="news_addtime">selected</eq>>时间</option>
              <option value="news_gold" <eq name="news_type" value="news_gold">selected</eq>>评分</option>
              <option value="news_id" <eq name="news_type" value="news_id">selected</eq>>ID</option>
            </select>            
            &nbsp;&nbsp;
            <select name="news_order" id="news_order" class="select">
              <option value="desc">降序</option>
              <option value="asc" <eq name="news_order" value="asc">selected</eq>>升序</option>
            </select>
            &nbsp;&nbsp;标题关键字：
            <input name="news_name" type="text" id="news_name" value="{$news_name|urldecode}" size="35" maxlength="50">
            <input name="news_submit" type="submit" value=" 显示 " class="mininput"></td>
        </tr>
      </table>
    </form>
    <form action="index.php?s=Admin-News-Show" method="post" name="myform">
      <table width="98%" border="0" cellpadding="4" cellspacing="1" class="tableoutline">
        <tr align="center" class="tb_title" >
          <td width="2%" nowrap >ID</td>
          <td >影片标题</td>
          <td width="5%" nowrap >点击</td>
          <td width="5%" nowrap >评分</td>
          <td width="12%" nowrap >时间</td>
          <td width="10%" nowrap >权重</td>
          <td width="5%" nowrap >状态</td>
          <td width="7%" nowrap >编辑</td>
        </tr>
        <volist name="list" id="ppcms">
        <php>if($ppcms["news_del"]==0){
            $isok_img = 'yes.gif';
            $isok_title= '已审核';
        }else{
            $isok_img = 'no.gif';
            $isok_title= '未审核';
        }
        $hot = array();
        $hot[$ppcms["news_stars"]] = 'class="hot_on"';</php>
          <tr class="firstalt">
            <td ><input name='news_id[{$ppcms.news_id}]' type='checkbox' value='{$ppcms.news_id}' style='border:none' checked></td>
            <td ><span class="conlist_cate"><if condition="c('url_html') eq 1"><a href="javascript:showhtml({$ppcms.news_id});"><font color="green">生成</font></a></if><a href="{$ppcms.news_showid}">『{:getlistname($ppcms["news_cid"])}』</a></span><a href="{$ppcms.news_readid}" onMouseOver="showpic(event,'{$ppcms.news_pic}');" target="_blank" onMouseOut="hiddenpic();">{$ppcms.news_name}</a> ({$ppcms.news_id})</td>
            <td align="center">{$ppcms.news_hits}</td>
            <td align="center">{$ppcms.news_gold}</td>
            <td align="center">{$ppcms.news_addtime|date='Y-m-d H:i:s',###}</td>
            <td align="center"><div class="hot_set"><a id="hot_{$ppcms.news_id}_1" href="javascript:sethot('{$ppcms.news_id}',1)"{$hot[1]}>1</a> <a id="hot_{$ppcms.news_id}_2" href="javascript:sethot('{$ppcms.news_id}',2)"{$hot[2]}>2</a> <a id="hot_{$ppcms.news_id}_3" href="javascript:sethot('{$ppcms.news_id}',3)"{$hot[3]}>3</a> <a id="hot_{$ppcms.news_id}_4" href="javascript:sethot('{$ppcms.news_id}',4)"{$hot[4]}>4</a> <a id="hot_{$ppcms.news_id}_5" href="javascript:sethot('{$ppcms.news_id}',5)"{$hot[5]}>5</a> </div></td>
            <td align="center" nowrap><a href="javascript:setisok('{$ppcms.news_id}')"><img id="isok_{$ppcms.news_id}" src="__PUBLIC__/images/{$isok_img}" title="{$isok_title}"></a></td>
            <td width="5%" colspan="2" align="center" nowrap ><a href="index.php?s=Admin-News-Add-news_id-{$ppcms.news_id}"><img src="__PUBLIC__/images/edit.gif" alt="编辑" width="14" height="14" border="0" align="absmiddle" title="编辑"></a><a href="index.php?s=Admin-News-Del-news_id-{$ppcms.news_id}" onClick="return confirm('确定删除?')"><img src="__PUBLIC__/images/del.gif" alt="删除" width="14" height="14" border="0" align="absmiddle" title="删除"></a></td>
          </tr>
        </volist>
        <tr class="firstalt">
          <td colspan="9" style=" padding:10px;"><div style="background:#CFF; padding:5px;"><input type="button" class="mininput" value="全/反选" onClick="CheckAll(this.form)" /> <if condition="c('url_html') eq 1"><input type="submit" class="mininput" value="生成静态" onClick="ChangeAction('index.php?s=Admin-News-ishtml')"/></if> <input type="submit" class="mininput" value="已审核" onClick="ChangeAction('index.php?s=Admin-News-isok')"/> <input type="submit" class="mininput" value="未审核" onClick="ChangeAction('index.php?s=Admin-News-notok')"/> <input type="submit" class="mininput" value="删除影片" onClick="ChangeAction('index.php?s=Admin-News-delall');return confirm('确定删除?')"/>&nbsp;设置为<select name="news_stars" class="select"><option value="0" selected>普通内容</option><option value="1">一星内容</option><option value="2">二星内容</option><option value="3">三星内容</option><option value="4">四星内容</option><option value="5">五星内容</option></select><input type="submit" class="mininput" value="设置星级" onClick="ChangeAction('index.php?s=Admin-News-stars')"/> &nbsp;转移到<select name="news_cid"><volist name="listnews" id="pp"><option value="{$pp.list_id}">{$pp.list_name}</option><volist name="pp['son']" id="pp"><option value="{$pp.list_id}">├ {$pp.list_name}</option></volist></volist></select><input type="submit" class="mininput" value="批量移动" onClick="ChangeAction('index.php?s=Admin-News-Listgo');return confirm('确定转移分类吗?')"/> &nbsp;<input name="news_otherkey" type="text"> <select name="news_other" class="select"><option value="0" selected>选择条件</option><option value="hits">点击次数</option><option value="addtime">更新时间</option><option value="gold">录入作者</option><option value="gold">变更评分</option></select> <input type="submit" class="mininput" value="批量变更" onClick="ChangeAction('index.php?s=Admin-News-other')"/></div></td>
        </tr>
        <tr class=firstalt>
          <td colspan="9"><div class="pages">{$page}</div></td>
        </tr>
      </table>
    </form>
<elseif condition="strtolower(ACTION_NAME) eq add" />
	<script type="text/javascript" charset="utf-8" src="__PUBLIC__/js/editor/kindeditor.js"></script>
    <style type="text/css" rel="stylesheet">
      .ke-icon-page {
      background-image: url(__PUBLIC__/js/editor/skins/page.gif);
      width: 31px;
      height: 16px;
      }
    </style>
    <script type="text/javascript"> KE.show({
	id : 'content',
	resizeMode : 1,
	allowPreviewEmoticons : false,
	allowUpload : false,
	items : [
	'source', '|', 'fontsize', 'textcolor', 'bgcolor', 'bold', 'italic', 'underline',
	'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
	'insertunorderedlist', '|', 'image', 'link', 'unlink']
	});	</script>
      <gt name="news_id" value="0">
      <form name="update" action="index.php?s=Admin-News-Update" method="post">
      <input type="hidden" name="news_id" id="news_id" value="{$news_id}">
      <else/>
      <form name="add" action="index.php?s=Admin-News-Insert" method="post">
      </gt>
      <table width="98%" border="0" cellpadding="4" cellspacing="1" class="tableoutline">
        <tr class="tb_head"><td colspan="2"><h2>添加新闻文章：</h2></td></tr>
 <tr class="firstalt">
          <td width="120" align="right">新闻文章参数：</td>
          <td ><select name="news_cid">
          <volist name="listnews" id="pp">
          <option value="{$pp.list_id}" <eq name="pp.list_id" value="$news_cid">selected</eq>>{$pp.list_name}</option>
              <volist name="pp['son']" id="pp">
              <option value="{$pp.list_id}" <eq name="pp.list_id" value="$news_cid">selected</eq>>├ {$pp.list_name}</option>
              </volist>
          </volist></select>&nbsp;&nbsp;
          <select name="news_stars">
          <option value="1" <eq name="news_stars" value="1">selected</eq>>一星</option>
          <option value="2" <eq name="news_stars" value="2">selected</eq>>二星</option>
          <option value="3" <eq name="news_stars" value="3">selected</eq>>三星</option>
          <option value="4" <eq name="news_stars" value="4">selected</eq>>四星</option>
          <option value="5" <eq name="news_stars" value="5">selected</eq>>五星</option>
          </select>&nbsp;&nbsp;
          <select name="news_del">
          <option value="0" <eq name="news_del" value="0">selected</eq>>显示</option>
          <option value="1" <eq name="news_del" value="1">selected</eq>>隐藏</option>
          </select>&nbsp;&nbsp;
          <select name="news_color">
          <option value=''>颜色</option>                                            
          <option value='#000000' style='background-color:#000000' <eq name="news_color" value="#000000">selected</eq>></option>
          <option value='#FFFFFF' style='background-color:#FFFFFF' <eq name="news_color" value="#FFFFFF">selected</eq>></option>
          <option value='#008000' style='background-color:#008000' <eq name="news_color" value="#008000">selected</eq>></option>
          <option value='#FFFF00' style='background-color:#FFFF00' <eq name="news_color" value="#FFFF00">selected</eq>></option>
          <option value='#FF0000' style='background-color:#FF0000' <eq name="news_color" value="#FF0000">selected</eq>></option>
          <option value='#0000FF' style='background-color:#0000FF' <eq name="news_color" value="#0000FF">selected</eq>></option> 
          <option value=''>无色</option>                     
          </select><label>栏目|权重|审核|颜色</label>
          </td>
        </tr>
        <tr class="firstalt">
          <td align="right">新闻文章标题：</td>
         <td><input name="news_name" type="text" size="60" maxlength="255" value="{$news_name}">&nbsp;&nbsp;首字母：<input name="news_letter" type="text" size="8" value="{$news_letter}" style="text-align:center"></td>
        </tr>
         <tr class="firstalt">
          <td align="right">新闻文章关键词：</td>
          <td><input name="news_keywords" type="text" size="60" maxlength="255" value="{$news_keywords}">&nbsp;&nbsp;人气值：<input name="news_hits" type="text" size="8" value="{$news_hits}" style="text-align:center"></td>
        </tr>       
        <tr class="firstalt">
          <td align="right">新闻文章来源：</td>
          <td><input name="news_reurl" type="text" size="60" value="{$news_reurl}">&nbsp;&nbsp;录入者：<input name="news_inputer" type="text" size="8" value="{$news_inputer}" style="text-align:center"></td>
        </tr>
        <tr class="firstalt">
          <td align="right">新闻文章缩略图：</td>
          <td><span style="float:left; margin-top:5px"><input name="news_pic" type="text" size="60" maxlength="255" value="{$news_pic}" onMouseOver="if(this.value)showpic(event, '{&upload_path}/'+this.value);" onMouseOut="hiddenpic();" style="height:22px"></span><span style="float:left;margin-top:5px"><iframe src="?s=Admin-Upload-Show-sid-news-fileback-news_pic" scrolling="no" topmargin="0" width="300" height="28" marginwidth="0" marginheight="0" frameborder="0" align="left"></iframe></span></td>
        </tr>
         <tr class="firstalt">
          <td align="right">文章TAG标签：</td>
          <td><input name="news_tag" id="news_tag" type="text" value="{$news_tag}" size="60"> <a href="javascript:showtags()"><img src="__PUBLIC__/images/tag.gif" alt="选择标签" width="26" height="26" border="0" align="absmiddle"></a> 评分值：<input name="news_gold" type="text" size="8" value="{$news_gold}" style="text-align:center"> 人次：<input name="news_golder" type="text" size="5" value="{$news_golder}" style="text-align:center"></td>
        </tr>       
        <tr class="firstalt">
          <td align="right">文章跳转链接：</td>
          <td><input name="news_gourl" type="text" value="{$news_gourl}" size="60">&nbsp;&nbsp;时间值：<input name="news_addtime" type="text" size="18" value="{$news_addtime|date='Y-m-d H:i:s',###}"> <gt name="news_id" value="0">更新<input name="news_time" type="checkbox" style="border:none" value="1" <if condition="c('admin_time_edit') eq 1">checked</if>></gt></td>
        </tr>        
        <tr class="firstalt">
          <td align="right">新闻文章简介：</td>
          <td><textarea name='news_remark' style="width:508px;height:50px;">{$news_remark}</textarea><br>＊ 如果不填写则自动截取文章内容的前100个字</td>
        </tr>        
         <tr class="firstalt">
          <td align="right">新闻文章内容：</td>
          <td><textarea id="content" name="news_content" style="width:708px;height:300px;">{$news_content}</textarea></td>
        </tr>
        <tr class="firstalt">
          <td colspan="2" align="center"><p><input class="bginput" type="submit" name="submit" value=" 提交 " > <input class="bginput" type="reset" name="Input" value=" 重置 " ></p></td>
        </tr>
      </table>
    </form>
</if>
    </div>
</div>
<include file="footer" />
</body>
</html>